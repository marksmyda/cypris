<p-table 
    #dt
    [value]="data.results"
    stripedRows [paginator]=true
    scrollable=true [showCurrentPageReport]="true"
    [rows]="5" [rowsPerPageOptions]="[5, 10, 25, 50]"
    [lazy]="true" (onLazyLoad)="loadPage($event)" [loading]="loading"
    [totalRecords]="data.totalHits">

    <ng-template #caption>
        <label>Query</label>
        <p-iconfield>
            <p-inputicon styleClass="pi pi-search" />
            <input #search pInputText type="text" (input)="onSearch(search.value)" placeholder="Search..." />
        </p-iconfield>
    </ng-template>

    <ng-template pTemplate="header">
        <tr>
            <th style="width: 5rem"></th>
            <th>Title</th>
            <th pSortableColumn="publishedDate">Published Date <p-sortIcon field="publishedDate" /></th>
            <th>Authors</th>
            <th>Publisher</th>
            <th pSortableColumn="citationCount">Citations <p-sortIcon field="citationCount" /></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-result let-expanded="expanded">
        <tr>
            <td>
                <p-button type="button" pRipple [pRowToggler]="result" [text]="true" [rounded]="true" [plain]="true" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
            </td>
            <td>{{ result.title }}</td>
            <td>{{ getDateFromString(result) }}</td>
            <td>{{ getAuthorNames(result) }}</td>
            <td>{{ result.publisher }}</td>
            <td>{{ result.citationCount }}</td>
        </tr>
    </ng-template>
    <ng-template #expandedrow let-result>
        <p-table [value]="result" dataKey="id">
            <tr>
                <th>ID</th>
                <th>Abstract</th>
                <th>Full Text</th>
            </tr>
            <tr>
                <td>{{ result.id }} </td>
                <td>{{ result.abstract }}</td>
                <td>{{ result.fullText }}</td>
            </tr>
        </p-table>
    </ng-template>
    <ng-template pTemplate="emptymessage">
        <tr>
            <td [attr.colspan]="6" class="text-center">
                <ng-container *ngIf="errorMsg; else noRows">
                    <p-message severity="error" [text]="errorMsg"></p-message>
                </ng-container>

                <ng-template #noRows>
                    <span>No records found.</span>
                </ng-template>
            </td>
        </tr>
    </ng-template>
</p-table>

<div class="chart-container" style="max-width: 500px;">
    <p-chart type="doughnut" [data]="fieldData" class="w-full md:w-[30rem]" />
</div>
